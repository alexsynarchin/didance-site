id: 55
source: 1
name: YandexMoney
category: YandexMoney
properties: 'a:19:{s:7:"account";a:7:{s:4:"name";s:7:"account";s:4:"desc";s:62:"Номер кошелька Яндекс (для физлиц)";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";N;s:4:"area";s:0:"";}s:12:"fail_page_id";a:7:{s:4:"name";s:12:"fail_page_id";s:4:"desc";s:76:"ИД страницы "неудачно завершенный платеж"";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";N;s:4:"area";s:0:"";}s:9:"method_ab";a:7:{s:4:"name";s:9:"method_ab";s:4:"desc";s:0:"";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:12:"method_cards";a:7:{s:4:"name";s:12:"method_cards";s:4:"desc";s:108:"Использовать метод оплаты - банковские карты VISA, MasterCard, Maestro";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:11:"method_cash";a:7:{s:4:"name";s:11:"method_cash";s:4:"desc";s:163:"Использовать способ оплаты - наличными в кассах и терминалах партнеров (только для юрлиц)";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:9:"method_ma";a:7:{s:4:"name";s:9:"method_ma";s:4:"desc";s:0:"";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:13:"method_mobile";a:7:{s:4:"name";s:13:"method_mobile";s:4:"desc";s:151:"Использовать метод оплаты - оплата со счета мобильного телефона (только для юрлиц)?";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:9:"method_pb";a:7:{s:4:"name";s:9:"method_pb";s:4:"desc";s:0:"";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:9:"method_qp";a:7:{s:4:"name";s:9:"method_qp";s:4:"desc";s:81:"Оплата через доверительный платеж (Куппи.ру)";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:9:"method_qw";a:7:{s:4:"name";s:9:"method_qw";s:4:"desc";s:35:"Оплата через QIWI Wallet";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:9:"method_sb";a:7:{s:4:"name";s:9:"method_sb";s:4:"desc";s:0:"";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:9:"method_wm";a:7:{s:4:"name";s:9:"method_wm";s:4:"desc";s:129:"Использовать метод оплаты - электронная валюта WebMoney (только для юрлиц)?";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:9:"method_ym";a:7:{s:4:"name";s:9:"method_ym";s:4:"desc";s:115:"Использовать способ оплаты - электронная валюта Яндекс.Деньги?";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}s:4:"mode";a:7:{s:4:"name";s:4:"mode";s:4:"desc";s:19:"Ваш статус";s:4:"type";s:4:"list";s:7:"options";a:3:{i:0;a:2:{s:4:"text";s:29:"Физическое лицо";s:5:"value";s:1:"1";}i:1;a:2:{s:4:"text";s:109:"Юридическое лицо (выбор способа оплаты на стороне магазина)";s:5:"value";s:1:"2";}i:2;a:2:{s:4:"text";s:116:"Юридическое лицо (выбор способа оплаты на стороне Яндекс.Кассы)";s:5:"value";s:1:"3";}}s:5:"value";s:1:"2";s:7:"lexicon";N;s:4:"area";s:0:"";}s:8:"password";a:7:{s:4:"name";s:8:"password";s:4:"desc";s:87:"Секретное слово (shopPassword) для обмена сообщениями";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";N;s:4:"area";s:0:"";}s:4:"scid";a:7:{s:4:"name";s:4:"scid";s:4:"desc";s:109:"Идентификатор витрины вашего магазина в Яндекс.Деньгах (scid)";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";N;s:4:"area";s:0:"";}s:6:"shopid";a:7:{s:4:"name";s:6:"shopid";s:4:"desc";s:96:"Идентификатор вашего магазина в Яндекс.Деньгах (ShopID)";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";N;s:4:"area";s:0:"";}s:15:"success_page_id";a:7:{s:4:"name";s:15:"success_page_id";s:4:"desc";s:72:"ИД страницы "удачно завершенный платеж"";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";N;s:4:"area";s:0:"";}s:8:"testmode";a:7:{s:4:"name";s:8:"testmode";s:4:"desc";s:28:"Тестовый режим?";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";N;s:4:"area";s:0:"";}}'

-----

$eventName = $modx->event->name;
$_isAdmin = ($modx->user->sudo == 1);

if(!defined('YANDEXMONEY_PATH')) define('YANDEXMONEY_PATH', MODX_CORE_PATH."components/yandexmoney/");
require_once YANDEXMONEY_PATH.'model/yandexmoney.class.php';

$ym = new Yandexmoney($modx, $scriptProperties);

if(!empty($_SESSION['shk_lastOrder']) && !empty($_SESSION['shk_lastOrder']['id'])){
    $ym->pay_method = !empty($_SESSION['shk_lastOrder']['payment']) ? $_SESSION['shk_lastOrder']['payment'] : '';
    $order_id = (int)$_SESSION['shk_lastOrder']['id'];    
}
if (!empty($_POST['payment'])){
	$ym->pay_method = $_POST['payment'];
}

if ($scriptProperties['action']=='showMethods') {
	$org_mode = ($scriptProperties['mode'] >= 2);
	$output = $ym->getSelectHtml();
	return $output;
}